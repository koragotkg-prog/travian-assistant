<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Travian Bot</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ===== FIXED HEADER ===== -->
  <header>
    <div class="header-brand">
      <span class="header-icon">âš¡</span>
      <h1>TRAVIAN BOT</h1>
    </div>
    <div class="header-right">
      <label class="browser-toggle" title="Toggle headed/headless browser">
        <input type="checkbox" id="togHeadless">
        <span>ğŸ‘ Browser</span>
      </label>
      <div class="header-status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Stopped</span>
      </div>
    </div>
  </header>

  <!-- Server & Village Selectors -->
  <div class="selector-bar">
    <div class="selector-group">
      <span class="selector-label">Server:</span>
      <select id="serverSelect"><option value="">No Server</option></select>
    </div>
    <div class="selector-group">
      <span class="selector-label">Village:</span>
      <select id="villageSelect"><option value="">-- Select Village --</option></select>
    </div>
  </div>

  <!-- ===== TAB BAR ===== -->
  <nav class="tab-bar">
    <button class="tab-btn active" data-tab="dash"><span class="tab-icon">ğŸ®</span><span class="tab-label">Dashboard</span></button>
    <button class="tab-btn" data-tab="config"><span class="tab-icon">âš™ï¸</span><span class="tab-label">Config</span></button>
    <button class="tab-btn" data-tab="ai"><span class="tab-icon">ğŸ§ </span><span class="tab-label">AI Strategy</span></button>
    <button class="tab-btn" data-tab="farm"><span class="tab-icon">âš”</span><span class="tab-label">Farm</span></button>
    <button class="tab-btn" data-tab="logs"><span class="tab-icon">ğŸ“‹</span><span class="tab-label">Logs</span></button>
    <button class="tab-btn" data-tab="settings"><span class="tab-icon">ğŸ”§</span><span class="tab-label">Settings</span></button>
  </nav>

  <!-- ===== MAIN LAYOUT: Sidebar + Content ===== -->
  <div class="main-layout">

    <!-- Resource Sidebar (always visible) -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <h4>Resources</h4>
        <div class="res-row"><span class="res-icon res-wood">ğŸªµ</span><span class="res-val" id="sideResWood">--</span><span class="res-prod" id="sideProdWood"></span></div>
        <div class="res-row"><span class="res-icon res-clay">ğŸ§±</span><span class="res-val" id="sideResClay">--</span><span class="res-prod" id="sideProdClay"></span></div>
        <div class="res-row"><span class="res-icon res-iron">â›</span><span class="res-val" id="sideResIron">--</span><span class="res-prod" id="sideProdIron"></span></div>
        <div class="res-row"><span class="res-icon res-crop">ğŸŒ¾</span><span class="res-val" id="sideResCrop">--</span><span class="res-prod" id="sideProdCrop"></span></div>
      </div>
      <div class="sidebar-section">
        <h4>Capacity</h4>
        <div class="cap-row"><span>WH:</span><span id="sideCapWarehouse">--</span></div>
        <div class="cap-row"><span>GR:</span><span id="sideCapGranary">--</span></div>
      </div>
      <div class="sidebar-section">
        <h4>Troops</h4>
        <div id="sideTroops" class="side-troops"><span class="text-muted">No data</span></div>
      </div>
      <div class="sidebar-section">
        <h4>Build Queue</h4>
        <div id="sideBuildQueue"><span class="text-muted">Empty</span></div>
      </div>
    </aside>

    <!-- Tab Content Area -->
    <main class="tab-content">

      <!-- TAB: DASHBOARD -->
      <div class="tab-panel active" id="panelDash">
        <section class="stats-grid">
          <div class="stat-card"><span class="stat-icon">âš¡</span><span class="stat-value" id="statCompleted">0</span><span class="stat-label">Completed</span></div>
          <div class="stat-card stat-card--danger"><span class="stat-icon">âœ•</span><span class="stat-value" id="statFailed">0</span><span class="stat-label">Failed</span></div>
          <div class="stat-card"><span class="stat-icon">â±</span><span class="stat-value" id="statUptime">--</span><span class="stat-label">Uptime</span></div>
          <div class="stat-card"><span class="stat-icon">ğŸ“Š</span><span class="stat-value" id="statRate">0</span><span class="stat-label">Actions/hr</span></div>
        </section>

        <div class="info-strip">
          <span class="info-strip-item"><span class="info-strip-icon">â³</span> Next: <span id="nextActionTimer">--</span></span>
          <span class="info-strip-item"><span class="info-strip-icon">âš”</span> Raids: <span id="farmRaidStats">0</span></span>
        </div>

        <section class="card">
          <h3 class="section-title">Current Task</h3>
          <div id="taskInfo" class="task-display">Idle</div>
          <div class="progress-bar-track"><div class="progress-bar-fill" id="taskProgressFill"></div></div>
        </section>

        <section class="card">
          <h3 class="section-title">Features</h3>
          <div class="toggle-grid">
            <label class="toggle-pill"><input type="checkbox" id="togResourceUpgrade" checked><span>Resources</span></label>
            <label class="toggle-pill"><input type="checkbox" id="togBuildingUpgrade" checked><span>Buildings</span></label>
            <label class="toggle-pill"><input type="checkbox" id="togTroopTraining"><span>Troops</span></label>
            <label class="toggle-pill"><input type="checkbox" id="togFarming" checked><span>Farming</span></label>
            <label class="toggle-pill"><input type="checkbox" id="togHeroAdventure" checked><span>Adventure</span></label>
          </div>
        </section>

        <!-- Resource Fields Visual Grid -->
        <section class="card">
          <div class="section-header">
            <h3 class="section-title">Resource Fields</h3>
            <div class="rf-quick-actions">
              <button id="btnCropAll5" class="btn-tiny" title="Set all crop fields â†’ Lv5">ğŸŒ¾â†’5</button>
              <button id="btnCropAll10" class="btn-tiny" title="Set all crop fields â†’ Lv10">ğŸŒ¾â†’10</button>
            </div>
          </div>
          <div id="resourceFieldGrid" class="rf-grid">
            <!-- Populated by app.js from gameState.resourceFields -->
            <div class="rf-placeholder text-muted">Scan to see resource fields.</div>
          </div>
        </section>

        <!-- Build Queue Preview -->
        <section class="card">
          <div class="section-header">
            <h3 class="section-title">Task Queue <span id="queueCount" class="badge">(0)</span></h3>
            <button id="btnClearQueue" class="btn-icon btn-danger-subtle" title="Clear Queue">ğŸ—‘</button>
          </div>
          <div id="taskQueueList" class="queue-list"></div>
          <!-- Build plan preview (tasks with type upgrade_resource / upgrade_building) -->
          <div id="buildPlanPreview" class="build-plan" style="display:none">
            <div class="build-plan-title">ğŸ“ Planned Builds</div>
            <div id="buildPlanList"></div>
          </div>
        </section>
      </div>

      <!-- TAB: CONFIG -->
      <div class="tab-panel" id="panelConfig">
        <section class="card">
          <div class="section-header">
            <h3 class="section-title">Upgrade Targets</h3>
            <div class="scan-actions">
              <div class="bld-filter-tabs" id="bldFilterTabs">
                <button class="bld-filter active" data-cat="all">All</button>
                <button class="bld-filter" data-cat="economy">Economy</button>
                <button class="bld-filter" data-cat="military">Military</button>
                <button class="bld-filter" data-cat="defense">Defense</button>
                <button class="bld-filter" data-cat="infrastructure">Infra</button>
              </div>
              <button id="btnScanBuildings" class="btn-small btn-glow">Scan</button>
            </div>
          </div>
          <div id="upgradeList" class="upgrade-list">
            <div class="upgrade-empty">Click "Scan" to load buildings.</div>
          </div>
        </section>

        <section class="card">
          <h3 class="section-title">Troop Training</h3>
          <div class="form-group">
            <label class="form-label">Troop Type</label>
            <select id="troopType">
              <option value="">-- Select --</option>
              <option value="t1">Legionnaire/Phalanx/Clubswinger</option>
              <option value="t2">Praetorian/Swordsman/Spearfighter</option>
              <option value="t3">Imperian/Pathfinder/Axefighter</option>
              <option value="t4">Scout</option>
              <option value="t5">Cavalry</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group form-group--half">
              <label class="form-label">Batch Size</label>
              <input type="number" id="troopBatch" value="5" min="1" max="100">
            </div>
            <div class="form-group form-group--half">
              <label class="form-label">Min Resources</label>
              <input type="number" id="troopMinRes" value="1000" min="0" step="100">
            </div>
          </div>
        </section>

        <section class="card">
          <h3 class="section-title">Timing & Safety</h3>
          <div class="form-row">
            <div class="form-group form-group--third">
              <label class="form-label">Min Delay (ms)</label>
              <input type="number" id="delayMin" value="2000" min="500" step="500">
            </div>
            <div class="form-group form-group--third">
              <label class="form-label">Max Delay (ms)</label>
              <input type="number" id="delayMax" value="8000" min="1000" step="500">
            </div>
            <div class="form-group form-group--third">
              <label class="form-label">Max Act/hr</label>
              <input type="number" id="maxActions" value="60" min="10" max="200">
            </div>
          </div>
        </section>

        <section class="card">
          <h3 class="section-title">Hero Adventure</h3>
          <div class="form-group">
            <label class="form-label">Min Health (%)</label>
            <input type="number" id="heroMinHealth" value="30" min="0" max="100">
          </div>
        </section>

        <section class="save-section">
          <button id="btnSaveAll" class="btn-primary btn-glow-primary">ğŸ’¾ Save All Settings</button>
        </section>
      </div>

      <!-- TAB: AI STRATEGY -->
      <div class="tab-panel" id="panelAI">
        <section class="card">
          <div class="section-header">
            <h3 class="section-title">AI Strategy</h3>
            <button id="btnRefreshStrategy" class="btn-small btn-glow">Refresh</button>
          </div>
          <div id="strategyDashboard" class="strategy-dashboard">
            <div class="strategy-placeholder">Start bot to see AI analysis.</div>
          </div>
        </section>
      </div>

      <!-- TAB: FARM -->
      <div class="tab-panel" id="panelFarm">
        <section class="card">
          <h3 class="section-title">Farming</h3>
          <div class="form-row">
            <div class="form-group form-group--half">
              <label class="form-label">Interval (sec)</label>
              <input type="number" id="farmInterval" value="300" min="60" max="3600">
            </div>
            <div class="form-group form-group--half">
              <label class="form-label">Min Troops</label>
              <input type="number" id="farmMinTroops" value="10" min="1">
            </div>
          </div>
          <label class="toggle-pill toggle-pill--wide"><input type="checkbox" id="togUseFarmList" checked><span>Use Rally Point Farm Lists</span></label>
        </section>

        <section class="card">
          <h3 class="section-title">Manual Targets</h3>
          <div id="farmTargetList"></div>
          <div class="farm-add">
            <input type="number" id="farmX" placeholder="X" class="input-sm">
            <input type="number" id="farmY" placeholder="Y" class="input-sm">
            <input type="text" id="farmName" placeholder="Name" class="input-sm input-name">
            <button id="btnAddFarm" class="btn-small btn-glow">Add</button>
          </div>
        </section>
      </div>

      <!-- TAB: LOGS -->
      <div class="tab-panel" id="panelLogs">
        <section class="card">
          <div class="section-header">
            <h3 class="section-title">Activity Log</h3>
            <button id="btnClearLogs" class="btn-icon btn-danger-subtle" title="Clear Logs">ğŸ—‘</button>
          </div>
          <div class="log-filters">
            <select id="logLevel">
              <option value="all">All Levels</option>
              <option value="INFO">Info</option>
              <option value="WARN">Warnings</option>
              <option value="ERROR">Errors</option>
            </select>
          </div>
          <div id="logViewer" class="log-area"></div>
        </section>
      </div>

      <!-- TAB: SETTINGS -->
      <div class="tab-panel" id="panelSettings">
        <section class="card">
          <h3 class="section-title">Browser</h3>
          <div class="setting-row">
            <span>Mode:</span>
            <span id="browserModeText">Headed (visible)</span>
          </div>
          <button id="btnToggleBrowser" class="btn-small btn-glow">Toggle Headed/Headless</button>
        </section>

        <section class="card">
          <h3 class="section-title">Cookie Import</h3>
          <p class="text-muted">Import cookies from Chrome to auto-login.</p>
          <button id="btnImportCookies" class="btn-small btn-glow">Import Chrome Cookies</button>
          <div id="cookieStatus" class="info-text"></div>
        </section>

        <section class="card">
          <h3 class="section-title">About</h3>
          <p class="text-muted">Travian Bot v1.0.0 â€” Standalone macOS App</p>
          <p class="text-muted">Powered by Tauri + Puppeteer</p>
        </section>
      </div>

    </main>
  </div>

  <!-- ===== FIXED CONTROL BAR ===== -->
  <footer class="control-bar">
    <button id="btnStart" class="ctrl-btn ctrl-btn--start">â–¶ Start</button>
    <button id="btnPause" class="ctrl-btn ctrl-btn--pause" disabled>â¸ Pause</button>
    <button id="btnStop" class="ctrl-btn ctrl-btn--stop" disabled>â¹ Stop</button>
    <button id="btnEmergency" class="ctrl-btn ctrl-btn--emergency" title="Emergency Stop">âš </button>
  </footer>

  <script src="app.js"></script>
</body>
</html>
